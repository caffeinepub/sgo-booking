{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-09T20:34:17.213Z",
  "summary": "The diff adds a new frontend Admin “Data Cleanup Utility” panel and a backend migration module hookup, but the provided backend diff snippet does not show implementation of the required admin-only maintenance API in `backend/main.mo` nor the specific cleanup logic for legacy room photos/payment methods/email-as-payment-method. The new UI also conflicts with the explicit non-goal of not adding a new UI for cleanup actions.",
  "missing_requirements": [
    {
      "id": "REQ-32",
      "requirement": "Add an admin-only backend maintenance API in `backend/main.mo` to clean legacy data for a specific hotel principal, rejected for non-admin callers, with no default workflow changes.",
      "reason": "The diff shows a new HARDCODED_ADMIN constant and a migration include, but does not show any new admin-only maintenance method definition or authorization checks for it in the truncated `backend/main.mo` snippet. The frontend calls `adminRemoveLegacyRoomPhotos` / `adminRemoveLegacyPaymentMethods`, but corresponding backend methods are not evidenced in the diff summary.",
      "evidence": [
        "backend/main.mo",
        "frontend/src/components/admin/DataCleanupPanel.tsx"
      ]
    },
    {
      "id": "REQ-33",
      "requirement": "When the admin maintenance API is run for a target hotel, delete legacy room photo data at the source of truth so `getHotels()` and `getRooms({hotelId})` no longer return those legacy photos, without affecting other hotels or non-legacy photos.",
      "reason": "No backend logic is shown that mutates room records/pictures to remove legacy photos. Only a frontend action calling `adminRemoveLegacyRoomPhotos` is shown; the actual backend deletion and scoping to the target hotel is not evidenced.",
      "evidence": [
        "frontend/src/components/admin/DataCleanupPanel.tsx",
        "backend/main.mo"
      ]
    },
    {
      "id": "REQ-34",
      "requirement": "When the admin maintenance API is run for a target hotel, remove legacy payment method entries (including 'GOPAY' and email-as-payment-method) persistently and ensure they do not reappear, without modifying other hotels and without auto-adding methods.",
      "reason": "No backend state cleanup code is shown for paymentMethods. The frontend calls `adminRemoveLegacyPaymentMethods`, but the corresponding persistent backend removal and prevention of reappearance is not evidenced in the diff summary.",
      "evidence": [
        "frontend/src/components/admin/DataCleanupPanel.tsx",
        "backend/main.mo"
      ]
    },
    {
      "id": "REQ-35",
      "requirement": "Ensure hotel email is represented only in `contact.email` and is not duplicated/derived into `paymentMethods` during reads or writes.",
      "reason": "The diff does not show changes to backend read/write paths (e.g., `getHotels()`, `getCallerHotelProfile()`, or payment-method add/update flows) that would prevent adding/retaining email-only entries in paymentMethods when `contact.email` is set.",
      "evidence": [
        "backend/main.mo"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Added a new frontend Admin UI panel for performing cleanup actions (DataCleanupPanel) with inputs and buttons to remove legacy photos/payment methods.",
      "reason": "The BuildRequest explicitly lists as a non-goal: “Adding a new UI for cleanup actions in guest/admin/hotel portals.” The diff adds such a UI and wires it into the Admin Panel page.",
      "evidence": [
        "frontend/src/components/admin/DataCleanupPanel.tsx",
        "frontend/src/pages/AdminPanelPage.tsx"
      ]
    },
    {
      "description": "Introduced a backend migration module (`backend/migration.mo`) and hooked it into `backend/main.mo` via `(with migration = Migration.run)`.",
      "reason": "The BuildRequest constraints require keeping logic in `backend/main.mo` and do not request adding a migration system/module. This appears to be additional unrequested infrastructure.",
      "evidence": [
        "backend/migration.mo",
        "backend/main.mo"
      ]
    }
  ],
  "confidence": 0.74,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "frontend-file-summaries.txt",
    "frontend/src/App.tsx",
    "frontend/src/components/admin/DataCleanupPanel.tsx",
    "frontend/src/pages/AdminPanelPage.tsx",
    "project_state.json"
  ]
}